---
title: "Lab09NotTeamOne"
author: "David Orozco, Ethan Schacht, Ryan Tate, Anderson Mun, Arie del Valle"
date: "March 14, 2019"
output: html_document
---
****
# Lab setup/test
**** 

```{r,echo=FALSE, warning=FALSE,include=FALSE}
#install.packages("tidyverse")
library(tidyverse)
library(lubridate)
#install.packages("OpenStreetMap")
library(OpenStreetMap)
library(ggplot2)
locations <- read.csv("Nice_Ride_2017_Station_Locations.csv")

trip <- read.csv("Nice_ride_trip_history_2017_season.csv")

```
```{r,echo=FALSE,message=FALSE}

locations <- read_csv("Nice_Ride_2017_Station_Locations.csv")
rides <- read_csv("Nice_ride_trip_history_2017_season.csv")

merged <- left_join(rides, locations, by = c("Start station number" = "Number")) %>%
  left_join(locations, by = c("End station number" = "Number")) %>%
  mutate(start_latitude = `Latitude.x`, start_longitude = `Longitude.x`, start_total_docks = `Total docks.x`) %>%
  mutate(end_latitude = `Latitude.y`, end_longitude = `Longitude.y`, end_total_docks = `Total docks.y`) %>%
  select(-`Name.x`, -`Name.y`, -`Latitude.x`, -`Longitude.x`, -`Total docks.x`, -`Latitude.y`, -`Longitude.y`, -`Total docks.y`)

merged <- merged[c(1:3, 9:11, 4:6, 12:14, 7:8)]
```
```{r,echo=FALSE,error=FALSE,warning=FALSE}
# Set latitudes and longitudes of city map
LAT1 <- 44.88     # Do not change
LAT2 <- 45.05     # Do not change
LON1 <- -93.35    # Do not change
LON2 <- -93.08    # Do not change

# Generate map
map <- openmap(c(LAT2,LON1), c(LAT1,LON2), zoom = NULL, # Can change zoom
               type = "esri",                           # Can change
               mergeTiles = TRUE)                       # Do not change

# Project map to latitude and longitude
map.latlon <- openproj(map, projection = "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs") # Do not change

# Plot map of Minneapolis
autoplot(map.latlon) # Plots a map 

# Plot all niceride stations
# If you are not plotting the map, use ggplot() instead of autoplot
#ggplot() +
autoplot(map.latlon) + # Plots a map 
  geom_point(data=locations, 
               aes(x=Longitude, y=Latitude), 
               color = 'blue', size = 1) +
  labs(x='Longitude', y='Latitude') +
  ggtitle('Locations of NiceRide Stations')
```
```{r,echo=FALSE} 
trip <- merged %>% separate(`Start date` , into = c("date","time"),sep = " ") %>% separate(time,into = c("hour","minute"),sep = ":")

trip$date <- mdy(trip$date) 
trip$hour <- parse_integer(trip$hour)
trip$minute <- parse_integer(trip$minute)

```
```{r,echo=FALSE,warning=FALSE,message=FALSE}
hallo <- trip %>% filter(date == '2017-10-31',hour < 8)
# Plot rides for halloween morning
#ggplot() +
autoplot(map.latlon) + # Plots a map 
  geom_segment(data=hallo, 
               aes(x=start_longitude, y=start_latitude,
                   xend=end_longitude, yend=end_latitude), 
               color = 'blue', size = .5,
               arrow = arrow(length = unit(0.2, "cm"))) +
  labs(x='Longitude', y='Latitude') +
  scale_x_continuous(limits = c(-93.3, -93.2)) +
  scale_y_continuous(limits = c(44.93, 45.02)) +
  ggtitle('Halloween Morning Rides')
```


****
#### David's Section
**** 
```{r,echo=FALSE}
# trying to find average distance(in coordinates traveled)

lat <- merged %>% select(c(1,4,5,7,10,11,14)) %>% mutate(chnglat = abs(start_latitude-end_latitude), chnglong = abs(start_longitude-end_longitude)) %>% separate(`Start date`, into = c("dateint","timeint"),sep = " ") %>% separate(`End date`,into = c("dateend","timeend"),sep = " ") %>% separate(timeend,into = c("hourend","minuteend"),sep = ":") %>% separate(timeint,into = c("hourint","minuteint"),sep = ":") 

#str <- lat[,c(1:5)]
#end <- lat[,c(6:13)] %>% rename("dateint" = "dateend")

#lat %>% count(dateint == dateend) %>% filter(n > 1)
#lat %>% count(hourint == hourend) %>% filter(n > 1)

returns <- lat %>% count(dateint == dateend, hourint == hourend) %>% filter(n > 1)
returns <- returns %>% mutate(percent = n/sum(returns$n))%>% mutate(SameDayReturn = `dateint == dateend`,SameHourReturn = `hourint == hourend`) %>% arrange(desc(percent))

returns <- returns[,c(5,6,3,4)]
returns

```

**** 
#### Arie's Section
****

**** 
#### Anderson's Section
****

**** 
#### Ethan's Section
****
```{r,echo=FALSE}

merged$`Start date` <- mdy_hm(merged$`Start date`)
merged$`End date` <- mdy_hm(merged$`End date`)

nice_ride <- merged %>%
  mutate(week_day = wday(`Start date`, label = TRUE)) %>%
  filter(`Account type` != "Inconnu")

ggplot(data = nice_ride) +
  geom_bar(mapping = aes(x = week_day, fill = `Account type`), position = "dodge") +
  xlab("Day of Week") +
  ylab("Count") +
  ggtitle("Distribution of Rides Throughout Week by Account Type")

week_stats <- nice_ride %>%
  group_by(week_day, `Account type`) %>%
  summarise(count = n())

```

* Question: How often do people use the Nice Ride depending on the day of week, and how
does this vary by account type?

* Methods: I first used left_join to combine the locations dataset with the overall rides
dataset, and then changed some variable names and sorted based on if the variables described
starting location or ending location.  I then parsed by times into mdy_hm and used w_day
to make a variable describing the day of week.  For the graph, used geom_bar to plot day
of week against count of rides for that day of week, filling with Account Type and using dodge
to compare the different memberships side-by-side for each day.  To get stats from this graph,
I grouped by the week day and account type and counted occurances of each combination.

* Findings: Most people tend to utilize the Nice Rides on the weekends, and this makes sense
because people tend to have more free time on these days.  Interestingly, member account 
types far outnumber casual account types on the weekdays, but casual account types outweigh
member account types on the weekends.  This is likely due to the fact that people who pay for
the membership are likely doing so because they also need it on the weekdays, perhaps to 
regularly commute to work, whereas casual riders who may be using the service for more 
leisurely reasons on the weekends don't as strongly require a regular membership.

* Stats: 
1. The most common riding day is Saturday, with a total of over 80,000 rides
2. Totals of at least 40,000 rides are taken by members on each week day, and totals of less
   than 20,000 rides are taken by casual members each weekday unless it's Friday
   
**** 
#### Ryan's Section
****